<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rezonateR">
<title>An introduction to rezonateR 0.1.0 • rezonateR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to rezonateR 0.1.0">
<meta property="og:description" content="rezonateR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rezonateR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.0000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Intro</h6>
    <a class="dropdown-item" href="../articles/overview.html">An introduction to rezonateR 0.1.0</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>An introduction to rezonateR 0.1.0</h1>
            
      
      
      <div class="d-none name"><code>overview.Rmd</code></div>
    </div>

    
    
<p>Welcome to the official vignette of rezonateR 0.1.0! As this is only
version 0.1.0, please tolerate all the mistakes you find and tell me (by
email, or in a GitHub issue) if you find any! :)</p>
<div class="section level2">
<h2 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h2>
<div class="section level3">
<h3 id="why-use-rezonater">Why use rezonateR?<a class="anchor" aria-label="anchor" href="#why-use-rezonater"></a>
</h3>
<p>If you’re reading this, you’re probably already using Rezonator to do
your daily work. Rezonator is a powerful tool for annotating and
visualising the dynamics of human engagement. The purpose of rezonateR
is to add a series of additional tools that enhance the functionality of
Rezonator and increase your productivity! My goal is to minimise the
time you spend on coding and annotating so you have more time for
<em>thinking</em>.</p>
<p>Rezonator has many cool features, but due to technical restrictions,
there are certain things it can’t do, such as:</p>
<ul>
<li>Dividing annotations into layers</li>
<li>Adding chunks and track chain entries that span multiple units</li>
<li>Linking tree entries to the corresponding chunks</li>
<li>Guessing the value of a field by looking at the values of other
fields</li>
<li>Automatically update the values of certain fields using information
from other fields</li>
</ul>
<p>rezonateR can do all these, and more!</p>
<p>Moreover, rezonateR is geared toward people of all skill levels in R.
I do a lot of the heavy lifting for you. As long as you have some
familiarity with base R, you can quickly pick up the basic functions,
but more advanced users can also extend it as they see fit.</p>
<p>The rezonateR engine is based heavily on Tidyverse packages,
particularly rlang and dplyr. Although you don’t need to be familiar
with Tidyverse to use the basic functionality, Tidyverse users will be
happy to see a wide range of functions that mimic Tidyverse functions in
appearance, but with additional fields to support the wide range of
functionality in rezonateR.</p>
<p>If you’re wondering when you should start learning rezonateR, the
best time is now! Although you can get started with the Rezonator GUI
relatively easily, if there are certain things you know you will use in
rezonateR - such as multi-line chunks - you probably want to have the
rezonateR post-processing in mind, even when you’re annotating in
Rezonator.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rezonators/rezonateR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-quick-import">A quick import<a class="anchor" aria-label="anchor" href="#a-quick-import"></a>
</h3>
<p>Let’s start by importing our first file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rezonators.github.io/rezonateR/">rezonateR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: dplyr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="co">#&gt; Loading required package: readr</span></span>
<span><span class="co">#&gt; Loading required package: stringr</span></span>
<span><span class="co">#&gt; Loading required package: rlang</span></span></code></pre></div>
<p>Now let’s import our first file, a short spoken text in Lhasa Tibetan
(you can find the original video here: <a href="https://av.mandala.library.virginia.edu/video/couple-must-part-threes-company-02" class="external-link uri">https://av.mandala.library.virginia.edu/video/couple-must-part-threes-company-02</a>).
This file contains a number of chunks, track chains, as well as trees,
and we will deal with them in this vignette:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"virginia-library-20766.rez"</span>, package <span class="op">=</span> <span class="st">"rezonateR"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">layerRegex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  track <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>field <span class="op">=</span> <span class="st">"trailLayer"</span>, regex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clausearg"</span>, <span class="st">"discdeix"</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clausearg"</span>, <span class="st">"discdeix"</span>, <span class="st">"refexpr"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chunk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>field <span class="op">=</span> <span class="st">"chunkLayer"</span>, regex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"verb"</span>, <span class="st">"adv"</span>, <span class="st">"predadj"</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"verb"</span>, <span class="st">"adv"</span>, <span class="st">"predadj"</span>, <span class="st">"refexpr"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/importRez.html">importRez</a></span><span class="op">(</span><span class="va">path</span>, layerRegex <span class="op">=</span> <span class="va">layerRegex</span>, concatFields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"word"</span>, <span class="st">"wordWylie"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Import starting - please be patient ...</span></span>
<span><span class="co">#&gt; Creating node maps ...</span></span>
<span><span class="co">#&gt; Creating rezrDFs ...</span></span>
<span><span class="co">#&gt; Adding foreign fields to rezrDFs and sorting (this is the slowest step) ...</span></span>
<span><span class="co">#&gt; &gt;Adding to unit entry DF ...</span></span>
<span><span class="co">#&gt; &gt;Adding to unit DF ...</span></span>
<span><span class="co">#&gt; &gt;Adding to chunk DF ...</span></span>
<span><span class="co">#&gt; &gt;Adding to track DFs ...</span></span>
<span><span class="co">#&gt; &gt;Adding to tree DFs ...</span></span>
<span><span class="co">#&gt; Splitting rezrDFs into layers ...</span></span>
<span><span class="co">#&gt; A few finishing touches ...</span></span>
<span><span class="co">#&gt; Done!</span></span></code></pre></div>
<p>The layerRegex object is a series of instructions to tell importRez
how to divide chunks and track chains into different layers. In this
case, I placed a field called ‘trailLayer’ on track chains, which has
three possible values: clausearg, discdeix, and nothing. These are
captured in the regex field. The first two regexes correspond to the two
names ‘clausearg’ and ‘discdeix’, and the default case where neither of
the first two regexes are detected is ‘refexpr’. I have done the same
thing to chunks, as you can see above. If you don’t want to use layers,
you don’t have to specify layerRegex. In that case, I will create a
single layer called ‘default’ for you.</p>
<p>The other mysterious field in the importRez function is concatFields.
These are fields belonging to tokens that you would like to concatenate
for higher-level units like chunks and tokens. For example, if tokens 1
and 2 are ‘happy’ and ‘person’, and you have a chunk that contains these
two tokens, you would want the whole string ‘happy person’ to be
associated with the chunk. Typically, you should specify at least one
field for doing this. In this case, we will concatenate the fields
‘word’ and ‘wordWylie’ (Wylie is the most common Romanisation system for
Tibetan). It is important not to overdo it, and specify too many fields
to concatenate, as this step can slow down your import considerably.</p>
<p>The result of the import is an object called rezrObj, which we will
discuss below. When you import a more substantial file, say around 30
minutes, the import speed can be rather slow. Please be patient! The
good news is that rezonateR contains functionality for saving and
loading rezrObj objects, so you don’t have to import each time you work
on a file in R.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">savePath</span> <span class="op">=</span> <span class="st">"myRez.Rdata"</span></span>
<span><span class="fu"><a href="../reference/saveload.html">rez_save</a></span><span class="op">(</span><span class="va">myRez</span>, <span class="va">savePath</span><span class="op">)</span></span>
<span><span class="co">#&gt; Saving rezrObj ...</span></span>
<span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/saveload.html">rez_load</a></span><span class="op">(</span><span class="va">savePath</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading rezrObj ...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="introduction-to-rezrobjs-and-nodemaps">Introduction to rezrObjs and nodeMaps<a class="anchor" aria-label="anchor" href="#introduction-to-rezrobjs-and-nodemaps"></a>
</h2>
<p>###rezrObjs</p>
<p>There are three main kinds of objects in rezonateR that you will
interact with directly, namely rezrObj, nodeMap and rezrDF. rezrObjs and
nodeMaps will be covered in this section. rezrDFs are relatively
complex, and will form the bulk of our discussion in this vignette.</p>
<p>rezrObj objects contain one single nodeMap and several rezrDFs:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Item in myRez:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Item in myRez:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "nodeMap"     "chunkDF"     "docDF"       "entryDF"     "linkDF"     </span></span>
<span><span class="co">#&gt;  [6] "mergedDF"    "tokenDF"     "trackDF"     "trailDF"     "treeDF"     </span></span>
<span><span class="co">#&gt; [11] "treeEntryDF" "treeLinkDF"  "unitDF"</span></span></code></pre></div>
<p>The relationships between the various entites are as follows:</p>
<ul>
<li><p>chunks and tree entries are built on top of tokens</p></li>
<li><p>entries correspond exactly to tokens, and units build on
entries</p></li>
<li><p>trackDF refers to both chunks and tokens</p></li>
</ul>
<p>This has some ramifications for updating, which we’ll come to
later.</p>
<div class="section level3">
<h3 id="nodemaps">nodeMaps<a class="anchor" aria-label="anchor" href="#nodemaps"></a>
</h3>
<p>The nodeMap is similar to the internal representation of the file
used in Rezonator-generated .rez files. The node map in .rez files are a
disorganised list of nodes, each of which correspond to an entity inside
Rezonator: units, tokens, and so on. The rezonateR nodeMap is similar.
The major difference is that nodes are organised into sub-categories,
according to the type of entity that the node is encoding. Let’s have a
sneak peak at these categories:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Items in the nodeMap:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Items in the nodeMap:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">nodeMap</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "token"     "entry"     "unit"      "track"     "chunk"     "card"     </span></span>
<span><span class="co">#&gt;  [7] "link"      "trail"     "stack"     "corpus"    "doc"       "treeEntry"</span></span>
<span><span class="co">#&gt; [13] "treeLink"  "tree"</span></span></code></pre></div>
<p>In practice, you will not interact with most of these nodeMaps except
token. Most of the time, you will only be dealing with rezrDFs, which
are much easier to work with. Let’s take a look at them.</p>
</div>
</div>
<div class="section level2">
<h2 id="introduction-to-rezrdfs">Introduction to rezrDFs<a class="anchor" aria-label="anchor" href="#introduction-to-rezrdfs"></a>
</h2>
<p>A rezrDF is like a normal data frame that you know from base R.
Here’s the beginning of the unit table:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">unitSeq</span>, <span class="va">srtLineBo</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            unitSeq srtLineBo              </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 22C69D930B150       1 <span style="color: #949494;">"</span>བཀྲ་-<span style="color: #949494;">"</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2456BC9E7C5D5       2 <span style="color: #949494;">"</span>བཀྲ་ཤིས་བདེ་ལེགས། <span style="color: #949494;">"</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 201A180965346       3 <span style="color: #949494;">"</span>ཕེབས་གནང་། <span style="color: #949494;">"</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2BD385D3E52C7       4 <span style="color: #949494;">"</span>རྒན་ངག་དབང་ལགས་ཡིན་ནམ། <span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2B558CAD0F0B4       5 <span style="color: #949494;">"</span>ལགས་ཡིན། ང་<span style="color: #949494;">"</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1213A3F8E28E0       6 <span style="color: #949494;">"</span>ལགས་ཡིན། ང་<span style="color: #949494;">"</span></span></span></code></pre></div>
<p>chunkDF, trackDF, rezDF, stackDF, etc., are divided into layers. If
you directly access the ‘chunkDF’ and ‘trackDF’ components of myRez, you
will get a list of rezrDFs, one for each layer. Here are the names of
our chunk layers that you might remember from the introduction, along
with the beginning of one of the associated rezrDFs:</p>
<pre class="{r}141"><code><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Component DFs of chunkDF:"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">chunkDF</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">chunkDF</span><span class="op">$</span><span class="va">refexpr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>rezrDF inherits from the Tidyverse ‘tibble’ structure, so all
tibble-related functions can be used with them. However, using classic
Tidyverse functions on rezrDFs is often dangerous, as rezrDFs have
additional functionality that go beyond classic rezrDFs.</p>
<p>There are three main differences that make rezrDF special:</p>
<div class="section level3">
<h3 id="perk-1-field-access-labels">Perk 1: Field access labels<a class="anchor" aria-label="anchor" href="#perk-1-field-access-labels"></a>
</h3>
<p>Field access labels prevents you from accidentally changing things
that you shouldn’t be changing. Let’s look at the field access values of
the unitDF:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"fieldaccess:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fieldaccess:"</span></span>
<span><span class="fu"><a href="../reference/getRezrDFAttr.html">fieldaccess</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span><span class="op">)</span></span>
<span><span class="co">#&gt;               id              doc        unitStart          unitEnd </span></span>
<span><span class="co">#&gt;            "key"           "core"           "core"           "core" </span></span>
<span><span class="co">#&gt;          unitSeq              pID     srtLineStart        srtLineBo </span></span>
<span><span class="co">#&gt;           "core"           "core"           "flex"           "flex" </span></span>
<span><span class="co">#&gt;            iuEnd          iuStart        srtLineEn               iu </span></span>
<span><span class="co">#&gt;           "flex"           "flex"           "flex"           "flex" </span></span>
<span><span class="co">#&gt;        srtLineID           iuText          speaker       srtLineEnd </span></span>
<span><span class="co">#&gt;           "flex"           "flex"           "flex"           "flex" </span></span>
<span><span class="co">#&gt;             word        wordWylie docTokenSeqFirst  docTokenSeqLast </span></span>
<span><span class="co">#&gt;        "foreign"        "foreign"        "foreign"        "foreign"</span></span></code></pre></div>
<p>There are five possible field access values: * ‘key’: The primary key
of the table. You are not allowed to change it (unless you turn it into
a non-key field, but this is not encouraged since you will basically
break everything). If you try to update these fields using rezonateR
functions, I will stop you with an error.</p>
<ul>
<li><p>‘core’: Core fields, mostly generated by Rezonator. You can
change them, but I will give you a warning if you do, because changing a
core field has strong potential to break things.</p></li>
<li><p>‘flex’: Flexible fields, usually fields whose values you enter
into Rezonator, though there are also flex fields automatically
generated by Rezonator.</p></li>
<li><p>‘auto’: Fields whose values are automatically generated using
information from the SAME rezrDF.</p></li>
<li><p>‘foreign’: Fields whose values are automatically generated using
information from a DIFFERENT rezrDF (or several different rezrDFs, but
this is an advanced feature we will stay away from in this
vignette.)</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="perk-2-reloads">Perk 2: Reloads<a class="anchor" aria-label="anchor" href="#perk-2-reloads"></a>
</h3>
<p>The reload() function is one of the core features of rezonateR that
makes it so convenient to use. The reload() feature is based on
updateFunctions. You can access the updateFunctions of a table using
updateFunct:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"updateFunct of unitDF:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "updateFunct of unitDF:"</span></span>
<span><span class="fu"><a href="../reference/getRezrDFAttr.html">updateFunct</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span><span class="op">)</span></span>
<span><span class="co">#&gt; $word</span></span>
<span><span class="co">#&gt; function (df, rezrObj) </span></span>
<span><span class="co">#&gt; updateLowerToHigher(df, rezrObj, address, fkeyAddress, action, </span></span>
<span><span class="co">#&gt;     field, fkeyInDF, seqName)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x000001d58b11d288&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x000001d58b104fd0&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "updateFunction" "function"      </span></span>
<span><span class="co">#&gt; attr(,"deps")</span></span>
<span><span class="co">#&gt; [1] "entryDF/word"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $wordWylie</span></span>
<span><span class="co">#&gt; function (df, rezrObj) </span></span>
<span><span class="co">#&gt; updateLowerToHigher(df, rezrObj, address, fkeyAddress, action, </span></span>
<span><span class="co">#&gt;     field, fkeyInDF, seqName)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x000001d58b115f68&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x000001d58b11cbf8&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "updateFunction" "function"      </span></span>
<span><span class="co">#&gt; attr(,"deps")</span></span>
<span><span class="co">#&gt; [1] "entryDF/wordWylie"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $docTokenSeqFirst</span></span>
<span><span class="co">#&gt; function (df, rezrObj) </span></span>
<span><span class="co">#&gt; updateLowerToHigher(df, rezrObj, address, fkeyAddress, action, </span></span>
<span><span class="co">#&gt;     field, fkeyInDF, seqName)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x000001d58b114c28&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x000001d58b1158d8&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "updateFunction" "function"      </span></span>
<span><span class="co">#&gt; attr(,"deps")</span></span>
<span><span class="co">#&gt; [1] "entryDF/docTokenSeq"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $docTokenSeqLast</span></span>
<span><span class="co">#&gt; function (df, rezrObj) </span></span>
<span><span class="co">#&gt; updateLowerToHigher(df, rezrObj, address, fkeyAddress, action, </span></span>
<span><span class="co">#&gt;     field, fkeyInDF, seqName)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x000001d58b1278f8&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x000001d58b114598&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "updateFunction" "function"      </span></span>
<span><span class="co">#&gt; attr(,"deps")</span></span>
<span><span class="co">#&gt; [1] "entryDF/docTokenSeq"</span></span></code></pre></div>
<p>There are three reload functions, reloadLocal(), reloadForeign() and
reload(). reloadLocal() only takes a rezrDF, and only updates auto
fields. reloadForeign() and reload() take a rezrDF and a rezrObj, and
updates the rezrDF using the rezrObj (which may or may not contain the
rezrDF).</p>
<p>Let’s take a look at reload(), which is the most useful function of
these. Here, in the original data, when there are zero mentions, only
the orthographic representation is written as &lt;0&gt;; the Wylie
romanisation is a blank string. I want to change the Wylie romanisation
to also contain &lt;0&gt;s. I do that by using the rez_mutate function
on the tokenDF first (don’t worry about what that means yet; we’ll cover
it later). After that, I reload the entryDF, and then reload the unitDF.
(Recall that the units depend on entries which in turn depend on tokens;
that’s why we can’t just reloated the unitDF directly.) After the
update, the unitDF is updated with &lt;0&gt;s appearing in the Wylie
romanisation:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Before the update"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Before the update"</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"&lt;0&gt;"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_select.html">rez_select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">wordWylie</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word                                           wordWylie        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 201A180965346 &lt;0&gt; ཕེབས་ གནང་ །                                <span style="color: #949494;">"</span> phebs  gnang  …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2BD385D3E52C7 &lt;0&gt; རྒན་ ངག་དབང་ ལགས་ ཡིན་ ནམ །                  <span style="color: #949494;">"</span> rgan  ngag dba…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2B558CAD0F0B4 ལགས་ &lt;0&gt; ཡིན །                                  <span style="color: #949494;">"</span>lags   yin /<span style="color: #949494;">"</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1A5B143F0646A ལགས་ &lt;0&gt; &lt;0&gt; རེད །                              <span style="color: #949494;">"</span>lags    red /<span style="color: #949494;">"</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2414F2965B74A ང་ འདི ར་ སྤྱིར་བཏང་ &lt;0&gt; སློབ་སྦྱོང་ བྱེད་ གར་ ཡོང་བ་ ཡིན ། <span style="color: #949494;">"</span>nga  'di ra  sp…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1FA517FFC43A  &lt;0&gt; སློབ་ཕྲུག་ ཡིན་ X X                             <span style="color: #949494;">"</span> slob phrug  yi…</span></span>
<span></span>
<span><span class="co">#Change something in the token rezrDF that is significant for the unit rezrDF</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_mutate.html">rez_mutate</a></span><span class="op">(</span></span>
<span>  wordWylie <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">word</span> <span class="op">==</span> <span class="st">"&lt;0&gt;"</span> <span class="op">~</span> <span class="st">"&lt;0&gt;"</span>, <span class="cn">T</span> <span class="op">~</span> <span class="va">wordWylie</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">entryDF</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">entryDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/reload.html">reload</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/reload.html">reload</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"After the update"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "After the update"</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"&lt;0&gt;"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_select.html">rez_select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">wordWylie</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word                                           wordWylie        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 201A180965346 &lt;0&gt; ཕེབས་ གནང་ །                                &lt;0&gt; phebs  gnang…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2BD385D3E52C7 &lt;0&gt; རྒན་ ངག་དབང་ ལགས་ ཡིན་ ནམ །                  &lt;0&gt; rgan  ngag d…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2B558CAD0F0B4 ལགས་ &lt;0&gt; ཡིན །                                  lags  &lt;0&gt; yin /  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1A5B143F0646A ལགས་ &lt;0&gt; &lt;0&gt; རེད །                              lags  &lt;0&gt; &lt;0&gt; re…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2414F2965B74A ང་ འདི ར་ སྤྱིར་བཏང་ &lt;0&gt; སློབ་སྦྱོང་ བྱེད་ གར་ ཡོང་བ་ ཡིན ། nga  'di ra  spy…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1FA517FFC43A  &lt;0&gt; སློབ་ཕྲུག་ ཡིན་ X X                             &lt;0&gt; slob phrug  …</span></span></code></pre></div>
<p>You might be wondering how to reload an entire rezrObj. Because
tables often depend on each other (for example, field A in table X
relies on field B in table Y which in turn relies on field C in table
X), this is technically difficult, but I plan to add this function
before the 1.0 release. Stay tuned!</p>
</div>
<div class="section level3">
<h3 id="perk-3-correpondences-to-nodemaps">Perk 3: Correpondences to nodeMaps<a class="anchor" aria-label="anchor" href="#perk-3-correpondences-to-nodemaps"></a>
</h3>
<p>rezrDFs encode information about whether a field is in the nodeMap or
not:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"inNodeMap:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "inNodeMap:"</span></span>
<span><span class="fu"><a href="../reference/getRezrDFAttr.html">inNodeMap</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span><span class="op">)</span></span>
<span><span class="co">#&gt;               id              doc        unitStart          unitEnd </span></span>
<span><span class="co">#&gt;            "key"        "primary"        "primary"        "primary" </span></span>
<span><span class="co">#&gt;          unitSeq              pID     srtLineStart        srtLineBo </span></span>
<span><span class="co">#&gt;        "primary"        "primary"         "tagmap"         "tagmap" </span></span>
<span><span class="co">#&gt;            iuEnd          iuStart        srtLineEn               iu </span></span>
<span><span class="co">#&gt;         "tagmap"         "tagmap"         "tagmap"         "tagmap" </span></span>
<span><span class="co">#&gt;        srtLineID           iuText          speaker       srtLineEnd </span></span>
<span><span class="co">#&gt;         "tagmap"         "tagmap"         "tagmap"         "tagmap" </span></span>
<span><span class="co">#&gt;             word        wordWylie docTokenSeqFirst  docTokenSeqLast </span></span>
<span><span class="co">#&gt;             "no"             "no"             "no"             "no"</span></span></code></pre></div>
<p>This doesn’t do so much yet, since you’re not yet allowed to push a
field created in a rezrDF back to a nodeMap. This will be available in
the 1.0 release.</p>
</div>
</div>
<div class="section level2">
<h2 id="editing-rezrdfs">Editing rezrDFs<a class="anchor" aria-label="anchor" href="#editing-rezrdfs"></a>
</h2>
<p>One of the core features of rezonateR is to facilitate the automatic
and semi-automatic creation of fields, which is currently not supported
in Rezonator. There are also other operations you may want to perform on
rezrDFs.</p>
<p>To cater to users of different habits and skill levels, I have
introduced three different levels of rezrDFs.</p>
<ol style="list-style-type: decimal">
<li><p>EasyEdit can be quickly picked up by everyone, including base R
users, and covers the most basic operations you would want to do to a
rezrDF (e.g. addField, changeFieldForeign)</p></li>
<li><p>TidyRez is easy to pick up for tidyverse users, though there is
some learning curve for others (e.g. rez_mutate, rez_left_join)</p></li>
<li><p>Core engine: These are mostly functions that I use within
rezonateR under the hood. Users who want maximum flexibility may also
use them (e.g. lowerToHigher, createLeftJoinUpdate), but do be aware
that I may make changes to these without notice, since I will assume
that most users have little use for them.</p></li>
</ol>
<p>Crucially, while EasyEdit and TidyRez syntax are very similar within
each category, functions within the core engine are a lot more
divergent, and EasyEdit and TidyRez also differ considerably in their
syntax. So if you are comfortable with TidyRez, minimising the use of
EasyEdit may make your code look more consistent, and vice versa.</p>
<div class="section level3">
<h3 id="easyedit">EasyEdit<a class="anchor" aria-label="anchor" href="#easyedit"></a>
</h3>
<p>EasyEdit consists of four commonly used functions, addFieldLocal,
addFieldForeign, changeFieldLocal and changeFieldForeign. There is also
a less useful function, addRow, that we will not cover in this vignette,
but you can check out the documentation if you would like to add a
row.</p>
<p>All of the four basic functions can be applied to both rezrDFs and
rezrObjs. In this vignette, we will mainly apply them to rezrObjs. If
you want to deal with emancipated rezrDFs, i.e. rezrDFs that are not
part of a rezrObj, you will want to use the versions that apply to
rezrDFs, but those are simpler than the rezrObj versions, so you should
be able to pick them up quickly using the manual.</p>
<p>Let’s start by looking at addFieldLocal. addField is a shortcut for
addFieldLocal, and we will be using this shortcut name throughout. Our
first example is very simple. In our tokenDF, let’s add a field that
automatically calculates the lengthg of a word in characters. Here,
‘entity’ specifies the name of the entity you would like to change,
‘layer’ specifies the layer within that entity (which is an empty string
since there are no token layers), fieldName is the name of the field
we’re adding, expression is the R expression with which we calculate the
new field, and fieldaccess tells rezonateR to make this an auto field
with an updateFunction that will be attached to the table:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/acField.html">addField</a></span><span class="op">(</span><span class="va">myRez</span>, entity <span class="op">=</span> <span class="st">"token"</span>, layer <span class="op">=</span> <span class="st">""</span>,</span>
<span>                 fieldName <span class="op">=</span> <span class="st">"orthoLength"</span>,</span>
<span>                 expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span>,</span>
<span>                 fieldaccess <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"A fragment of the updated table:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A fragment of the updated table:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_select.html">rez_select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">orthoLength</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word   orthoLength</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2ECADE1029CD3 བཀྲ་-             5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 15A5089F6157A བཀྲ་ཤིས་           8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 197AA4A0C625F བདེ་ལེགས           8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2C7746BD6F150 །                1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 354CBFB3632B6 &lt;0&gt;              3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2D1DAD2FFF22A ཕེབས་             5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"The updateFunction:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The updateFunction:"</span></span>
<span><span class="fu"><a href="../reference/getRezrDFAttr.html">updateFunct</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span>, <span class="st">"orthoLength"</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (df) </span></span>
<span><span class="co">#&gt; updateMutate(df, field, x)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x000001d5850353a8&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "updateFunction" "function"      </span></span>
<span><span class="co">#&gt; attr(,"deps")</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>Now let’s spice this up a bit by adding a complex field. A complex
field takes information from multiple rows of a table. In this case, we
are working with the tokenDF, but want the new column to be the longest
length of the word that appears in the unit that the token comes from.
In this case, the groupField is ‘unit’, and we specify the field type as
‘complex’. The expression uses the function longestLength, which is a
rezonateR function that returns the longest word in a series of
words.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/acField.html">addField</a></span><span class="op">(</span><span class="va">myRez</span>, entity <span class="op">=</span> <span class="st">"token"</span>, layer <span class="op">=</span> <span class="st">""</span>,</span>
<span>                 fieldName <span class="op">=</span> <span class="st">"longestWordInUnit"</span>,</span>
<span>                 expression <span class="op">=</span> <span class="fu"><a href="../reference/complexActions.html">longestLength</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span>,</span>
<span>                 type <span class="op">=</span> <span class="st">"complex"</span>,</span>
<span>                 groupField <span class="op">=</span> <span class="st">"unit"</span>,</span>
<span>                 fieldaccess <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">longestWordInUnit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word   longestWordInUnit</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2ECADE1029CD3 བཀྲ་-                   5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 15A5089F6157A བཀྲ་ཤིས་                 8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 197AA4A0C625F བདེ་ལེགས                 8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2C7746BD6F150 །                      8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 354CBFB3632B6 &lt;0&gt;                    5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2D1DAD2FFF22A ཕེབས་                   5</span></span></code></pre></div>
<p>Now let’s add a simple foreign field. Let’s say when we look at the
tokenDF, we also want to know what the whole unit’s words are. The
source is the ‘word’ field of units, and we are creating a new field for
tokens called ‘unitWord’. The foreign key is the field that contains IDs
of the source table inside the target table, in this case the ‘unit’
field of tokenDF:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/acFieldForeign.html">addFieldForeign</a></span><span class="op">(</span><span class="va">myRez</span>,</span>
<span>                targetEntity <span class="op">=</span> <span class="st">"token"</span>, targetLayer <span class="op">=</span> <span class="st">""</span>,</span>
<span>                sourceEntity <span class="op">=</span> <span class="st">"unit"</span>, sourceLayer <span class="op">=</span> <span class="st">""</span>,</span>
<span>                targetForeignKeyName <span class="op">=</span> <span class="st">"unit"</span>,</span>
<span>                targetFieldName <span class="op">=</span> <span class="st">"unitWord"</span>, sourceFieldName <span class="op">=</span> <span class="st">"word"</span>,</span>
<span>                fieldaccess <span class="op">=</span> <span class="st">"foreign"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">unitWord</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word   unitWord       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2ECADE1029CD3 བཀྲ་-   བཀྲ་-           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 15A5089F6157A བཀྲ་ཤིས་ བཀྲ་ཤིས་ བདེ་ལེགས །</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 197AA4A0C625F བདེ་ལེགས བཀྲ་ཤིས་ བདེ་ལེགས །</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2C7746BD6F150 །      བཀྲ་ཤིས་ བདེ་ལེགས །</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 354CBFB3632B6 &lt;0&gt;    &lt;0&gt; ཕེབས་ གནང་ །</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2D1DAD2FFF22A ཕེབས་   &lt;0&gt; ཕེབས་ གནང་ །</span></span></code></pre></div>
<p>Now let’s wrap it up with a complex field foreign field. Here, we’re
going to add a field in the unitDF that tells us the length of the
shortest word within the unit. We’re going to base this off the entry
DF.</p>
<p>However, because the entries that correspond to units are given in
the nodeMap, you also need to supply the list of entries inside the unit
nodeMap - here it’s called entryList. Chunks and tree entries are built
on tokens instead, so they have a list called tokenList. Instead of
‘expression’, complex foreign fields have a field called complexAction,
which is a function performed on the source field of the source
table:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/acFieldForeign.html">addFieldForeign</a></span><span class="op">(</span><span class="va">myRez</span>,</span>
<span>                targetEntity <span class="op">=</span> <span class="st">"unit"</span>, targetLayer <span class="op">=</span> <span class="st">""</span>,</span>
<span>                sourceEntity <span class="op">=</span> <span class="st">"entry"</span>, sourceLayer <span class="op">=</span> <span class="st">""</span>,</span>
<span>                targetForeignKeyName <span class="op">=</span> <span class="st">"entryList"</span>,</span>
<span>                targetFieldName <span class="op">=</span> <span class="st">"shortestWordLength"</span>,</span>
<span>                sourceFieldName <span class="op">=</span> <span class="st">"word"</span>,</span>
<span>                type <span class="op">=</span> <span class="st">"complex"</span>,</span>
<span>                complexAction <span class="op">=</span> <span class="va">shortestLength</span>,</span>
<span>                fieldaccess <span class="op">=</span> <span class="st">"foreign"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">shortestWordLength</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word                          shortestWordLength</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 22C69D930B150 བཀྲ་-                                           5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2456BC9E7C5D5 བཀྲ་ཤིས་ བདེ་ལེགས །                                1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 201A180965346 &lt;0&gt; ཕེབས་ གནང་ །                                1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2BD385D3E52C7 &lt;0&gt; རྒན་ ངག་དབང་ ལགས་ ཡིན་ ནམ །                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2B558CAD0F0B4 ལགས་ &lt;0&gt; ཡིན །                                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1213A3F8E28E0 ང་                                             2</span></span></code></pre></div>
<p>(Because of the technicality that punctuation counts as a character,
most of these values are 1. There are ways we can fix this using isWord
conditions, as we’ll discuss below.)</p>
<p>So far we’ve only looked at addField, but the good news is that
changeField works in 100% the exact same way! Here’s an example,
changing our orthoLength field to depend on the Romanisation instead of
the original Tibetan script:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/acField.html">changeField</a></span><span class="op">(</span><span class="va">myRez</span>, entity <span class="op">=</span> <span class="st">"token"</span>, layer <span class="op">=</span> <span class="st">""</span>,</span>
<span>                 fieldName <span class="op">=</span> <span class="st">"orthoLength"</span>,</span>
<span>                 expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">wordWylie</span><span class="op">)</span>,</span>
<span>                 fieldaccess <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"A fragment of the updated table:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A fragment of the updated table:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_select.html">rez_select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">orthoLength</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word   orthoLength</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2ECADE1029CD3 བཀྲ་-             8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 15A5089F6157A བཀྲ་ཤིས་          10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 197AA4A0C625F བདེ་ལེགས           8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2C7746BD6F150 །                1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 354CBFB3632B6 &lt;0&gt;              3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2D1DAD2FFF22A ཕེབས་             6</span></span></code></pre></div>
<p>Note that <em>if you don’t specify the field access value, I will
automatically change it to flex, even in changeField</em>. This is to
force you to remember that you are not only changing the value of the
field itself, but also how it will be updated in the future. If you
don’t supply a field access value and it’s originally an auto or foreign
field, I will warn you about this change, so you can run changeField
again if you want to change your mind.</p>
</div>
<div class="section level3">
<h3 id="tidyrez">TidyRez<a class="anchor" aria-label="anchor" href="#tidyrez"></a>
</h3>
<p>In general, TidyRez functions are called by adding ‘rez_’ in front of
a dplyr function name, such a rez_group_by or rez_mutate. Using TidyRez
functions allows you to keep and/or update your field access values,
inNodeMap values, and updateFunctions. Using base R or classic dplyr
functions with rezrDFs may result in reload fails, unless supplemented
by core engine functions, which are not covered in this vignette.</p>
<p>A few dplyr functions are completely safe to use in rezonateR, mostly
those that focus on selecting rows of a table, such as filter(),
arrange() or slice(). Currently implemented TidyRez functions
include:</p>
<ul>
<li><p>rez_add_row for adding new entries</p></li>
<li><p>rez_mutate for adding and editing columns</p></li>
<li><p>rez_rename for renaming columns</p></li>
<li><p>rez_bind_rows for combining rezrDFs vertically</p></li>
<li><p>rez_group_split for splitting rezrDFs vertically</p></li>
<li><p>rez_group_by and rez_ungroup for grouping</p></li>
<li><p>rez_select for selecting certain columns inside a rezrDF</p></li>
<li><p>rez_left_join for left joins</p></li>
</ul>
<p>A few other planned ones include rez_bind_cols and rez_outer_join,
which will be especially useful for the calculation of inter-annotator
agreement.</p>
<p>Because TidyRez is relatively straightforward for Tidyverse users,
this vignette will focus on what TidyRez adds on top of Tidyverse. If
you want to learn about basic Tidyverse, there are many existing
tutorials on the Internet.</p>
<p>To see the power of TidyRez, let’s try creating an emancipated rezrDF
with only a subset of the original columns. Here, we take
trackDF$refexpr, the table of referential expressions. We then damage
one of the fields using a classic dplyr function. As you can see here,
the emancipated rezrDF can still be updated using the rezrObj,
effectively overriding the damage:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">refTable</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_select.html">rez_select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">token</span>, <span class="va">chain</span>, <span class="va">name</span>, <span class="va">word</span>, <span class="va">tokenOrderLast</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Before:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Before:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">refTable</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">tokenOrderLast</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   id            tokenOrderLast</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 3D148B2FEEA8               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1CA978DCDE1DB              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 14C5BE6658C39              4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1FE8CC91923D1              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 33A483E30E811              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 280CA1A8A425               1</span></span>
<span><span class="va">refTable</span> <span class="op">=</span> <span class="va">refTable</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tokenSeqLast <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#Damage refTable with a classic dplyr function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"After:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "After:"</span></span>
<span><span class="va">refTable</span> <span class="op">=</span> <span class="va">refTable</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/reload.html">reload</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">refTable</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">tokenOrderLast</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   id            tokenOrderLast</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 3D148B2FEEA8               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1CA978DCDE1DB              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 14C5BE6658C39              4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1FE8CC91923D1              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 33A483E30E811              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 280CA1A8A425               1</span></span></code></pre></div>
<p>A warning is in order: TidyRez only updates <em>the current
table</em>. If other tables have references to the table you’re editing,
they will not be updated. You must bear this in mind when using
rez_select and rez_rename. No problems will arise if you use these
functions on emancipated rezrDFs. However, if you use these functions on
rezrDFs within rezrObjs, you should manually update any fields in other
rezrDFs that refer to the field you’ve deleted or added. I plan to add a
rename feature to EasyEdit in the near future that will update
references from other rezrDFs.</p>
<p>Most of the TidyRez functions’ syntax deviate from dplyr only
minimally in ways that you can read about in the documentation. However,
rez_left_join is worth a quick mention. In addition to a fieldaccess
field and a rezrObj field, which are self-explanatory, there is a fkey
field and a df2Address field. fkey is the name of the field in the first
data.frame that corresponds to IDs of the second data.frame. df2Address
is a string that tells rez_left_join how to find the source rezrDF next
time. If the source rezrDF doesn’t belong to a layer, e.g. tokenDF, just
type that. If the source rezrDF belongs to a layer, put a ‘/’ between
the table and the layer, e.g. ‘trackDF/refexpr’.</p>
</div>
</div>
<div class="section level2">
<h2 id="an-interlude-time-and-sequence">An interlude: Time and sequence<a class="anchor" aria-label="anchor" href="#an-interlude-time-and-sequence"></a>
</h2>
<p>Before we continue our adventure, let’s look at a couple of ways we
can upgrade our rezrObj to contain even more information.</p>
<p>The first thing we can do, which we hinted at before, is to set
certain tokens as non-words. You can do this with the addIsWordField
function. One immediate benefit of this is that we get a new sequence
value. The fields tokenOrder and docTokenSeq values in the original
rezrDF count all tokens, whereas wordOrder and docWordSeq will only
count tokens counted as words according to some criterion. Let’s set our
criterion to !str_detect(wordWylie, “/”), i.e. the token must not
contain the main punctuation mark in Tibetan. Notice that wordOrder is
generally slightly lower than tokenOrder:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/addIsWordField.html">addIsWordField</a></span><span class="op">(</span><span class="va">myRez</span>, <span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">wordWylie</span>, <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">tokenDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">tokenOrder</span>, <span class="va">docTokenSeq</span>, <span class="va">wordOrder</span>, <span class="va">docWordSeq</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   id            tokenOrder docTokenSeq wordOrder docWordSeq</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2ECADE1029CD3          1           1         1          1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 15A5089F6157A          1           2         1          2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 197AA4A0C625F          2           3         2          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2C7746BD6F150          3           4         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 354CBFB3632B6          1           5         1          4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2D1DAD2FFF22A          2           6         2          5</span></span></code></pre></div>
<p>By default, unitSeq information is not available to rezrDFs other
than unitDF. You can change this using the addUnitSeq feature, which can
add unitSeq information up to track chains:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/addUnitSeq.html">addUnitSeq</a></span><span class="op">(</span><span class="va">myRez</span>, <span class="st">"track"</span><span class="op">)</span></span></code></pre></div>
<p>This adds a unitSeqFirst and unitSeqLast field to chunks and track
chains entries, and a unitSeq field to tokens.</p>
</div>
<div class="section level2">
<h2 id="updating-rezonater-using-external-information">Updating rezonateR using external information<a class="anchor" aria-label="anchor" href="#updating-rezonater-using-external-information"></a>
</h2>
<p>Some annotation actions are easier with a spreadsheet than in a
Rezonator, so one action you will frequently perform is to do
annotations in a spreadsheet programme and then integrate that
information back into a rezrObj. Fortunately, rezonateR contains
functionality that can facilitate this and minimise errors generated in
the process.</p>
<p>Let’s say we want to annotate the person of the referential
expressions inside trackDF$refexpr. Before we start annotating manually,
I wrote some simple rules to guess what the person is that works for
most situations, so we will only have to correct from this baseline:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_mutate.html">rez_mutate</a></span><span class="op">(</span>person <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">word</span> <span class="op">==</span> <span class="st">"ང"</span> <span class="op">|</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"ང་"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"(ཁྱེད|ཁྱོད|ཇོ་ལགས|ཨ་ཅག་ལགས|རྒན་ལགས)"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_ends</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"(ལགས|&lt;0&gt;)"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>, <span class="co">#Multiple likely scenarios</span></span>
<span><span class="cn">T</span> <span class="op">~</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Before we export this as a CSV for annotation, I would like to add a
column inside the rezrDF that gives us the word of the entire unit.
(Since this document currently does not have multi-unit track entries,
it will suffice to use unitLast or unitFirst). It will be useful to be
able to see this column while making manual annotations:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/rez_left_join.html">rez_left_join</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_select.html">rez_select</a></span><span class="op">(</span><span class="va">unitSeq</span>, <span class="va">word</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>unitSeqLast <span class="op">=</span> <span class="st">"unitSeq"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_unit"</span><span class="op">)</span>, df2key <span class="op">=</span> <span class="st">"unitSeq"</span>, df2Address <span class="op">=</span> <span class="st">"unitDF"</span>, fkey <span class="op">=</span> <span class="st">"unitSeqLast"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/rez_rename.html">rez_rename</a></span><span class="op">(</span>unitLastWord <span class="op">=</span> <span class="va">word_unit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tip: When performed on a rezrDF inside a rezrObj, rez_rename is a potentially destructive action. It is NOT recommended to assign it back to a rezrDF inside a rezrObj. If you must do so, be careful to update all addresses from other DFs to this DF.</span></span></code></pre></div>
<p>The next step is to write the CSV file. rez_write_csv allows us to do
this easily. The third argument of rez_write_csv is a vector of field
names that we want to export. It is advisable to keep the number of
exported fields small to make the spreadsheet more manageable and
require less scrolling:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rw.html">rez_write_csv</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span>, <span class="st">"refexpr.csv"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"unitLastWord"</span>, <span class="st">"unitSeqLast"</span>, <span class="st">"word"</span>, <span class="st">"docTokenSeqLast"</span>, <span class="st">"entityType"</span>, <span class="st">"roleType"</span>, <span class="st">"person"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>After editing the CSV in a spreadsheet program, let’s import it back
using rez_read_csv. (I’ve renamed the edited CSV - in general, I
recommend doing this to avoid accidentally overwriting your edited file
by running the export code again.) The origDF argument tells rezonateR
to look in the original rezrDF that produced the CSV, and determine the
data types accordingly:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">changeDF</span> <span class="op">=</span> <span class="fu"><a href="../reference/rw.html">rez_read_csv</a></span><span class="op">(</span><span class="st">"refexpr_edited.csv"</span>, origDF <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the updateFromDF function allows us to update the original
rezrDF using information from the new rezrDF. There are many fancy
option you can choose from, such as deciding whether to delete rows, add
rows, add columns, etc. We will only use the most vanilla options, and
update the ‘person’ column:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/updateFromDF.html">updateFromDF</a></span><span class="op">(</span><span class="va">changeDF</span>, changeCols <span class="op">=</span> <span class="st">'person'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">person</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   id            word             person</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 3D148B2FEEA8  &lt;0&gt;                  <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1CA978DCDE1DB &lt;0&gt;                  <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 14C5BE6658C39 རྒན་ ངག་དབང་ ལགས་     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1FE8CC91923D1 &lt;0&gt;                  <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 33A483E30E811 ང་                   <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 280CA1A8A425  འདི་                  <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysing-track-chains-with-easytrack">Analysing track chains with EasyTrack<a class="anchor" aria-label="anchor" href="#analysing-track-chains-with-easytrack"></a>
</h2>
<p>Now that we’ve looked at an example of semi-automatic annotation,
let’s move on to some full automation! We will be looking in particular
at coreference chains. rezonateR contains a suite of functions for
generating features useful for analysing the choice of referential
forms, reference comprehension, and similar topics.</p>
<div class="section level3">
<h3 id="anaphoric-and-cataphoric-distance">Anaphoric and cataphoric distance<a class="anchor" aria-label="anchor" href="#anaphoric-and-cataphoric-distance"></a>
</h3>
<p>Let’s first find out how many units we are from the previous mention
of something. This is equivalent to the gapUnit column that already
exists as automatically generated by Rezonator:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/rez_mutate.html">rez_mutate</a></span><span class="op">(</span>unitsToLastMention <span class="op">=</span> <span class="fu"><a href="../reference/trackPrevContext.html">unitsToLastMention</a></span><span class="op">(</span><span class="va">unitSeqLast</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">gapUnits</span>, <span class="va">unitsToLastMention</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 3</span></span></span>
<span><span class="co">#&gt;   id            gapUnits unitsToLastMention</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 134D42FB97545 0                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 183DC7932D931 7                         7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1373D1F88358  N/A                      <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2DBE5E8F59A6D 1                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F20CE11F519F  1                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1366768617    2                         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 287C6AAAA209D N/A                      <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Now let’s count the tokens from the last mention using the
tokensToLastMention() function. This one has a couple of complications.
The first one is which seq to count. In the interlude, we mentioned that
in addition to docTokenSeq, we have a sequence value called docWordSeq
that excludes nonwords. We will use that value in counting. The second
complication is how we will treat zero mentions. Zeros do not actually
exist in the world, so they have no time to speak of. The ‘zeroProtocol’
argumentis ‘unitFinal’, telling rezonateR to count the last word of
whatever unit the zero comes from. Finally, since we’re dealing with
units, we need to pass the unitDF to ensure that tokensToLastMention can
have access to unit information:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span>  <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/rez_mutate.html">rez_mutate</a></span><span class="op">(</span>wordsToLastMention <span class="op">=</span> <span class="fu"><a href="../reference/trackPrevContext.html">tokensToLastMention</a></span><span class="op">(</span></span>
<span>    <span class="va">docWordSeqLast</span>, <span class="co">#What seq to use</span></span>
<span>    zeroProtocol <span class="op">=</span> <span class="st">"unitFinal"</span>, <span class="co">#How to treat zeroes</span></span>
<span>    zeroCond <span class="op">=</span> <span class="op">(</span><span class="va">word</span> <span class="op">==</span> <span class="st">"&lt;0&gt;"</span><span class="op">)</span>,</span>
<span>    unitDF <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">unitDF</span><span class="op">)</span><span class="op">)</span> <span class="co">#Additional argument for unitFinal protocol</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">wordsToLastMention</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   id            wordsToLastMention</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 134D42FB97545                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 183DC7932D931                 22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1373D1F88358                  <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2DBE5E8F59A6D                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F20CE11F519F                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1366768617                     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 287C6AAAA209D                 <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Note that unitsToNextMention and tokensToNextMention work in the same
way.</p>
</div>
<div class="section level3">
<h3 id="tallying-preceding-and-following-mentions">Tallying preceding and following mentions<a class="anchor" aria-label="anchor" href="#tallying-preceding-and-following-mentions"></a>
</h3>
<p>We can also count how many previous mentions of something there were
within a window of units. Most people do five or 20 unit. Let’s try this
with 5. The countPrevMentions allows us to do this (countNextMentions
does this but for the succeeding context):</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_mutate.html">rez_mutate</a></span><span class="op">(</span>noPrevMentionsIn5 <span class="op">=</span> <span class="fu"><a href="../reference/trackPrevContext.html">countPrevMentions</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">noPrevMentionsIn5</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   id            noPrevMentionsIn5</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 134D42FB97545                 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 183DC7932D931                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1373D1F88358                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2DBE5E8F59A6D                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F20CE11F519F                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1366768617                    2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 287C6AAAA209D                 0</span></span></code></pre></div>
<p>Sometimes, we may want to extract previous mentions conditionally,
e.g. only count subject mentions or zero mentions. The functions
countPrevMentionsIf and countNextMentionIf allow us to define such a
condition. Let’s try counting the number of coming zero mentions. Here,
we use the condition word == “&lt;0&gt;”, i.e. the word is a zero, and
the window is Inf, i.e. there’s no limit on how far in the future we
look:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_mutate.html">rez_mutate</a></span><span class="op">(</span>noComingZeroes <span class="op">=</span> <span class="fu"><a href="../reference/trackPrevContext.html">countNextMentionsIf</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="va">word</span> <span class="op">==</span> <span class="st">"&lt;0&gt;"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">noComingZeroes</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   id            noComingZeroes</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 134D42FB97545              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 183DC7932D931              9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1373D1F88358               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2DBE5E8F59A6D              9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F20CE11F519F               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1366768617                 8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 287C6AAAA209D              1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="counting-competitors">Counting competitors<a class="anchor" aria-label="anchor" href="#counting-competitors"></a>
</h3>
<p>We may also want to count competing mentions, that is, recent
mentions not coreferential to the current mention. countCompetitors()
tallies the number of competitors intervening between the previous and
current mention, possibly within a window. Here is one example with no
window:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_mutate.html">rez_mutate</a></span><span class="op">(</span>noCompetitors <span class="op">=</span> <span class="fu"><a href="../reference/countCompetitors.html">countCompetitors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">noComingZeroes</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   id            noComingZeroes</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 134D42FB97545              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 183DC7932D931              9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1373D1F88358               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2DBE5E8F59A6D              9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F20CE11F519F               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1366768617                 8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 287C6AAAA209D              1</span></span></code></pre></div>
<p>All of the functions introduced in this section have additional
fields that allow for further customisation. Please feel free to refer
to the manual for more information.</p>
</div>
</div>
<div class="section level2">
<h2 id="adding-tree-information">Adding tree information<a class="anchor" aria-label="anchor" href="#adding-tree-information"></a>
</h2>
<p>Now let’s add some information from trees. The first thing to do is
to run the getAllTreeCorrespondences function, which adds a treeEntry
column to non-tree tables. If you select entity = “track”, this column
will be added to tokenDF, chunkDF and trackDF.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/getAllTreeCorrespondences.html">getAllTreeCorrespondences</a></span><span class="op">(</span><span class="va">myRez</span>, entity <span class="op">=</span> <span class="st">"track"</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">treeEntry</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   id            treeEntry    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 134D42FB97545 23E6B9A16C426</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 183DC7932D931 253E6EE11F308</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1373D1F88358  1E1D73A61D4B0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2DBE5E8F59A6D 5E28BE8ED183 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F20CE11F519F  363329E4BBB94</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1366768617    281F8FC643F88</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 287C6AAAA209D 364D86848B187</span></span></code></pre></div>
<p>The best thing that trees do for us is connecting verb information,
stored in chunks, to track chain entry (i.e. referential expression)
information. We can do this in two steps. First we add a treeParent
column to trackDF$refexpr that takes the value of the ‘parent’ column of
treeEntryDF; in simple terms, this means we’re getting the parent tree
entry’s ID into trackDF$refexpr. We then use this parent tree entry’s ID
to find the corresponding verb chunk, and with this, we have
successfully put the verb on the trackDF$refexpr table.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="va">myRez</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/acFieldForeign.html">addFieldForeign</a></span><span class="op">(</span><span class="st">"track"</span>, <span class="st">"refexpr"</span>, <span class="st">"treeEntry"</span>, <span class="st">"default"</span>, <span class="st">"treeEntry"</span>, <span class="st">"treeParent"</span>, <span class="st">"parent"</span>, fieldaccess <span class="op">=</span> <span class="st">"foreign"</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op">=</span> <span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/rez_left_join.html">rez_left_join</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">$</span><span class="va">chunkDF</span><span class="op">$</span><span class="va">verb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">word</span>, <span class="va">treeEntry</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>treeParent <span class="op">=</span> <span class="st">"treeEntry"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_verb"</span><span class="op">)</span>, df2Address <span class="op">=</span> <span class="st">"chunkDF/verb"</span>, fkey <span class="op">=</span> <span class="st">"treeParent"</span>, df2key <span class="op">=</span> <span class="st">"treeEntry"</span>, rezrObj <span class="op">=</span> <span class="va">myRez</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>verbID <span class="op">=</span> <span class="va">id_verb</span>, verbWord <span class="op">=</span> <span class="va">word_verb</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">trackDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">treeParent</span>, <span class="va">verbID</span>, <span class="va">verbWord</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">#&gt;   id            treeParent    verbID        verbWord     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 134D42FB97545 16CA7768343C0 2CFB905E634DE རེད           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 183DC7932D931 2EA73E6E3BED4 30E122DAF5010 ཕེབས་པ་ ཡིན་ ནམ</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1373D1F88358  2EA73E6E3BED4 30E122DAF5010 ཕེབས་པ་ ཡིན་ ནམ</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2DBE5E8F59A6D 359A5ED8BE360 2CCFFAD41AD38 ཡོང་པ་ ཡིན     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F20CE11F519F  359A5ED8BE360 2CCFFAD41AD38 ཡོང་པ་ ཡིན     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1366768617    A4DB76F5C0EB  A4DC56F0B165  ཡོང་བ་ ཡིན     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 287C6AAAA209D A4DB76F5C0EB  A4DC56F0B165  ཡོང་བ་ ཡིན</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="advanced-chunk-mergers">Advanced: Chunk mergers<a class="anchor" aria-label="anchor" href="#advanced-chunk-mergers"></a>
</h2>
<p>The last topic to cover is merging chunks, most useful for creating
muti-line chunks. There are several steps to merging chunks:</p>
<ol style="list-style-type: decimal">
<li><p>Create constituent chunks that span the entire merged
chunk</p></li>
<li><p>Create a tree leaf that contains all tokens in the merged chunk,
and put the leaf in a tree.</p></li>
<li><p>Use the mergeChunksWithTree command in rezonateR to merge
them.</p></li>
</ol>
<p>mergeChunksWithTree is very easy to use. After you call this command,
the merged chunks will be added to the bottom of the correponding chunk
rezrDF. Chunk tags are taken from the first constituent chunk of each
merger by default; see the manual for setting custom conditions. There
will in addition be a column called combinedChunk that tells you whether
a chunk is a combined chunk, a member of a combined chunk, or
neither.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/mergeChunksWithTree.html">mergeChunksWithTree</a></span><span class="op">(</span><span class="va">myRez</span><span class="op">)</span></span>
<span><span class="va">myRez</span><span class="op">$</span><span class="va">chunkDF</span><span class="op">$</span><span class="va">refexpr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">combinedChunk</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">name</span>, <span class="va">word</span>, <span class="va">combinedChunk</span><span class="op">)</span> <span class="co">#Showing only combined chunks and their members</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   id            name        word                                   combinedChunk</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 51A902A7C6CD  Chunk 49    ཁོང་ ཚོ་ ནས་                             |infomember-…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2E2B9BB6462BC Chunk 51    དཔེ་སྐྲུན་ ཞུས་པ་ དེ་                        |member-ZeYI…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 17842C4087863 Chunk 235   ཕྱི་རྒྱལ་ ནུབ་ཕྱོགས་པ འི་ མི་རིགས་ འདི་འདྲས་       |infomember-…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> EF4325E7D5A9  Chunk 81    བོད་སྐད་ ནང་ བྲིས་པ འི་ རྒྱལ་རབས་ ཀྱི་ དེབ་      |member-oCa9…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZeYIoFhw4Bd9u New Chunk 1 ཁོང་ ཚོ་ ནས་ དཔེ་སྐྲུན་ ཞུས་པ་ དེ་             combined     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> oCa9fWZ7LEjJ2 New Chunk 2 ཕྱི་རྒྱལ་ ནུབ་ཕྱོགས་པ འི་ མི་རིགས་ འདི་འདྲས་ བོད་སྐ… combined</span></span></code></pre></div>
<p>You may also augment the trackDF with the merged chunks; the
combinedChunk column works similarly:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRez</span> <span class="op">=</span> <span class="fu"><a href="../reference/mergedChunksToTrack.html">mergedChunksToTrack</a></span><span class="op">(</span><span class="va">myRez</span>, <span class="st">"refexpr"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by John W Du Bois, Ryan Ka Yau Lai.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
